# –ü—Ä–æ–±–ª–µ–º–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏ –º–µ–∂—Ñ–∞–π–ª–æ–≤–æ–≥–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è

## üî¥ –ü—Ä–æ–±–ª–µ–º–∞

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ú–µ–∂—Ñ–∞–π–ª–æ–≤–æ–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ

**–°–∏—Ç—É–∞—Ü–∏—è:**
- `FileA.php` —Å–æ–¥–µ—Ä–∂–∏—Ç –º–µ—Ç–æ–¥ `process()`
- `FileB.php` —Å–æ–¥–µ—Ä–∂–∏—Ç –º–µ—Ç–æ–¥ `process()` (85% –ø–æ—Ö–æ–∂–µ)
- `DuplicationDetector` —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ **–≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞**

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ù–ï –Ω–∞–π–¥–µ–Ω–æ!

**–ü—Ä–∏—á–∏–Ω–∞:**
```javascript
// DuplicationDetector.js - —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –í–ù–£–¢–†–ò —Ñ–∞–π–ª–∞
analyze(code, filePath) {
  const methods = this.extractAllMethods(node); // –¢–æ–ª—å–∫–æ –º–µ—Ç–æ–¥—ã —ç—Ç–æ–≥–æ —Ñ–∞–π–ª–∞!
  // –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –º–µ—Ç–æ–¥—ã –¢–û–õ–¨–ö–û –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
}
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

**–°–∏—Ç—É–∞—Ü–∏—è:**
1. –ù–∞–π–¥–µ–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `FileA.php` –∏ `FileB.php`
2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ `FileA.php` 
3. –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫ –∞–Ω–∞–ª–∏–∑–∞

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü—Ä–æ–±–ª–µ–º–∞ –≤—Å–µ –µ—â–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –¥–ª—è `FileB.php`, —Ö–æ—Ç—è —É–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤ `FileA.php`

## ‚úÖ –†–µ—à–µ–Ω–∏—è

### –†–µ—à–µ–Ω–∏–µ 1: –ú–µ–∂—Ñ–∞–π–ª–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä (–°–æ–∑–¥–∞–Ω)

–°–æ–∑–¥–∞–Ω `CrossFileDuplicationDetector.js` –∫–æ—Ç–æ—Ä—ã–π:
- ‚úÖ –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –í–°–ï —Ñ–∞–π–ª—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- ‚úÖ –ù–∞—Ö–æ–¥–∏—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ú–ï–ñ–î–£ —Ñ–∞–π–ª–∞–º–∏
- ‚úÖ –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –º–µ—Ç–æ–¥—ã –∏–∑ —Ä–∞–∑–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```javascript
const crossDetector = new CrossFileDuplicationDetector();
const issues = crossDetector.analyze(filesData); // –í—Å–µ —Ñ–∞–π–ª—ã!
```

### –†–µ—à–µ–Ω–∏–µ 2: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π (–ù—É–∂–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)

**–ü–æ–¥—Ö–æ–¥ 1: –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑**
```bash
# –ê–Ω–∞–ª–∏–∑ —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
npm start -- --git-diff

# –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞–π–¥–µ—Ç —Ñ–∞–π–ª—ã —Å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ–º
```

**–ü–æ–¥—Ö–æ–¥ 2: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤**
```javascript
// –°–æ—Ö—Ä–∞–Ω—è—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞ –≤ –ë–î/—Ñ–∞–π–ª
{
  "file": "FileA.php",
  "checksum": "abc123",
  "issues": [...],
  "timestamp": "2025-10-28T..."
}
```

–ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—É—Å–∫–µ:
- –°—Ä–∞–≤–Ω–∏—Ç—å checksum —Ñ–∞–π–ª–∞
- –ï—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª—Å—è - –ø–µ—Ä–µ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å
- –ü–æ–∫–∞–∑–∞—Ç—å –£–î–ê–õ–ï–ù–ù–´–ï –ø—Ä–æ–±–ª–µ–º—ã (–µ—Å–ª–∏ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)

## üìã –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –í–∞—Ä–∏–∞–Ω—Ç A: Git-based –ø–æ–¥—Ö–æ–¥ (–ü—Ä–æ—Å—Ç–æ–π)

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–ª–∞–≥–∏ `--git-diff` –∏ `--git-staged`:

```bash
# –ü–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º
npm start -- --git-staged

# –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
git commit -m "Fix duplication"

# –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —á—Ç–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
npm start -- --git-diff
```

### –í–∞—Ä–∏–∞–Ω—Ç B: –§–∞–π–ª —Å –∏—Å—Ç–æ—Ä–∏–µ–π (–°—Ä–µ–¥–Ω—è—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å)

–°–æ–∑–¥–∞—Ç—å `.refactoring/analysis-history.json`:
```json
{
  "files": {
    "app/Services/OrderService.php": {
      "lastChecked": "2025-10-28T...",
      "checksum": "abc123",
      "issues": ["issue1", "issue2"]
    }
  }
}
```

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ:
1. –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é
2. –°—Ä–∞–≤–Ω–∏—Ç—å checksum —Ñ–∞–π–ª–æ–≤
3. –ü–µ—Ä–µ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–∏–≤—à–∏–µ—Å—è
4. –ü–æ–º–µ—Ç–∏—Ç—å –∏—Å—á–µ–∑–Ω—É–≤—à–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∫–∞–∫ "resolved"

### –í–∞—Ä–∏–∞–Ω—Ç C: –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (–°–ª–æ–∂–Ω—ã–π)

–î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞:
```javascript
class CodeAnalyzer {
  async analyze(files, analyzers, linter) {
    const cache = await this.loadCache();
    
    for (const file of files) {
      const fileHash = await this.hashFile(file);
      
      if (cache.has(fileHash) && !this.isModified(file)) {
        // –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å - —Ñ–∞–π–ª –Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è
        continue;
      }
      
      // –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å
      const results = await this.analyzeFile(file);
      await this.saveCache(fileHash, results);
    }
  }
}
```

## üéØ –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

### ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:
1. –í–Ω—É—Ç—Ä–∏—Ñ–∞–π–ª–æ–≤–æ–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ (DuplicationDetector)
2. Git-based –∞–Ω–∞–ª–∏–∑ (`--git-diff`, `--git-staged`)
3. –ú–µ–∂—Ñ–∞–π–ª–æ–≤—ã–π –¥–µ—Ç–µ–∫—Ç–æ—Ä (CrossFileDuplicationDetector)

### ‚ö†Ô∏è –ù–ï —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:
1. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è CrossFileDuplicationDetector –≤ index.js
2. –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ history/results –º–µ–∂–¥—É –∑–∞–ø—É—Å–∫–∞–º–∏
3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ "–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö" –ø—Ä–æ–±–ª–µ–º

## üöÄ –ë—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–ï—Å–ª–∏ –∏—Å–ø—Ä–∞–≤–∏–ª–∏ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ–±–∞ —Ñ–∞–π–ª–∞:**
```bash
npm start -- --files="FileA.php,FileB.php"
```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
```bash
git add FileA.php
npm start -- --git-staged
```

3. **–ü–æ–ª–Ω—ã–π –ø–µ—Ä–µ-–∞–Ω–∞–ª–∏–∑:**
```bash
rm -rf refactoring/code-report.json
npm start -- --path=/project --refactor-dir=refactoring
```

## üìä –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```bash
# –ù–∞—á–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑
npm start -- --path=/myProject --refactor-dir=refactoring

# –ù–∞–π–¥–µ–Ω–æ: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ FileA –∏ FileB

# –ò—Å–ø—Ä–∞–≤–∏–ª–∏ FileA
git add FileA.php
git commit -m "Fix duplication"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å
npm start -- --path=/myProject --refactor-dir=refactoring --git-diff
# ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ –∏—Å—á–µ–∑–ª–∞!

# –ò–ª–∏ –ø–æ–ª–Ω—ã–π –ø–µ—Ä–µ-–∞–Ω–∞–ª–∏–∑
npm start -- --path=/myProject --refactor-dir=refactoring
# ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ –¥–ª—è FileB —Ç–æ–∂–µ –∏—Å—á–µ–∑–ª–∞!
```

## üí° –ò—Ç–æ–≥

**–ü—Ä–æ–±–ª–µ–º–∞:** –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –Ω–µ –∑–Ω–∞–µ—Ç —á—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ –≤–ª–∏—è—é—Ç –Ω–∞ –¥—Ä—É–≥–∏–µ

**–†–µ—à–µ–Ω–∏–µ:** 
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `--git-diff` –¥–ª—è –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
- –ò–ª–∏ –¥–µ–ª–∞—Ç—å –ø–æ–ª–Ω—ã–π –ø–µ—Ä–µ-–∞–Ω–∞–ª–∏–∑ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
- –ú–µ–∂—Ñ–∞–π–ª–æ–≤—ã–π –¥–µ—Ç–µ–∫—Ç–æ—Ä —Å–æ–∑–¥–∞–Ω –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–ª—è production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Git-based –ø–æ–¥—Ö–æ–¥ + –ø–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.

